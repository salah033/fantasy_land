{% extends "base.html" %}
{% load static %}
{% block content %}

<h1 class="dash-header__title">Dashboard</h1>

{% if user.is_authenticated %}
  <p class="dash-welcome__text">Welcome, <span class="dash-welcome__username">{{ user.username }}</span></p>
{% endif %}

<div class="dash-card-grid">

  <a href="{% url 'MEMO_FORM' %}" class="dash-card dash-card--primary" role="button" tabindex="0" aria-label="Add a Memo">
    <div class="dash-card__icon">üìù</div>
    <h3 class="dash-card__title">Add Memo</h3>
    <p class="dash-card__desc">Create a new memo to stay organized</p>
  </a>

  <a href="{% url 'SHOW_MEMO' %}" class="dash-card dash-card--secondary" role="button" tabindex="0" aria-label="Show Memos">
    <div class="dash-card__icon">üìö</div>
    <h3 class="dash-card__title">Show Memos</h3>
    <p class="dash-card__desc">View and manage all your memos</p>
  </a>

  {% if user.is_authenticated %}
  <a href="{% url 'ACCOUNTS_LOGOUT' %}" class="dash-card dash-card--logout" id="logout-link" role="button" tabindex="0" aria-label="Log Out">
    <div class="dash-card__icon">üö™</div>
    <h3 class="dash-card__title">Log Out</h3>
    <p class="dash-card__desc">Securely log out from your account</p>
  </a>
  {% endif %}
  
</div>

<!-- Logout Modal -->
<div id="logout-modal" class="dash-modal" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="dash-modal__content" role="document">
    <p class="dash-modal__text">Are you sure you want to logout?</p>
    <div class="dash-modal__buttons">
      <button id="confirm-logout" class="dash-btn dash-btn--confirm">Yes</button>
      <button id="cancel-logout" class="dash-btn dash-btn--cancel">Cancel</button>
    </div>
  </div>
</div>

<meta name="csrf-token" content="{{ csrf_token }}">

<style>
  /* Basic font & color */
  body, .dash-header__title, .dash-welcome__text {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
      Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    color: #222f3e;
  }
  .dash-header__title {
    font-weight: 800;
    font-size: 3rem;
    letter-spacing: 1.2px;
    margin-bottom: 2rem;
    text-transform: uppercase;
    user-select: none;
    text-align: center;
    color: #0a3d62;
  }
  .dash-welcome__text {
    font-size: 1.4rem;
    text-align: center;
    margin-bottom: 2.5rem;
  }
  .dash-welcome__username {
    font-weight: 700;
    color: #3c40c6;
  }

  /* Cards grid */
  .dash-card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.8rem;
    max-width: 900px;
    margin: 0 auto 4rem;
    padding: 0 1rem;
  }

  /* Cards */
  .dash-card {
    background: white;
    border-radius: 14px;
    box-shadow:
      0 4px 10px rgba(60, 64, 198, 0.1),
      0 8px 20px rgba(60, 64, 198, 0.07);
    padding: 1.8rem 1.6rem;
    cursor: pointer;
    text-decoration: none;
    color: #222f3e;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1), 
                box-shadow 0.3s ease, 
                background-color 0.3s ease;
    user-select: none;
    position: relative;
  }
  .dash-card:hover,
  .dash-card:focus-visible {
    transform: translateY(-8px) scale(1.03);
    box-shadow:
      0 10px 30px rgba(60, 64, 198, 0.2),
      0 18px 50px rgba(60, 64, 198, 0.15);
    outline: none;
  }
  .dash-card:focus-visible {
    outline: 3px solid #3c40c6;
    outline-offset: 6px;
  }

  .dash-card__icon {
    font-size: 3.6rem;
    margin-bottom: 1rem;
    transition: transform 0.3s ease;
  }
  .dash-card:hover .dash-card__icon,
  .dash-card:focus-visible .dash-card__icon {
    transform: scale(1.15) rotate(5deg);
  }
  .dash-card__title {
    font-weight: 700;
    font-size: 1.3rem;
    margin-bottom: 0.5rem;
  }
  .dash-card__desc {
    font-weight: 400;
    font-size: 1rem;
    color: #596275;
    text-align: center;
    line-height: 1.3;
  }

  /* Card color variations */
  .dash-card--primary {
    background: linear-gradient(135deg, #3c40c6, #0fbcf9);
    color: white;
  }
  .dash-card--primary .dash-card__desc {
    color: rgba(255, 255, 255, 0.85);
  }
  .dash-card--secondary {
    background: #f1f2f6;
    color: #3c40c6;
  }
  .dash-card--logout {
    background: #ee5253;
    color: white;
  }

  /* Modal styles */
  .dash-modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(10, 15, 36, 0.75);
    align-items: center;
    justify-content: center;
    z-index: 2000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }
  .dash-modal.show {
    display: flex;
    opacity: 1;
    pointer-events: all;
  }
  .dash-modal__content {
    background: white;
    padding: 2.5rem 2rem;
    border-radius: 16px;
    max-width: 360px;
    width: 90%;
    box-shadow:
      0 4px 15px rgba(0,0,0,0.2),
      0 10px 20px rgba(60, 64, 198, 0.15);
    text-align: center;
    transform: translateY(-30px);
    animation: slideDownFadeIn 0.35s forwards;
  }
  @keyframes slideDownFadeIn {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .dash-modal__text {
    font-size: 1.25rem;
    margin-bottom: 2rem;
    font-weight: 600;
    color: #222f3e;
  }
  .dash-modal__buttons {
    display: flex;
    justify-content: center;
    gap: 1rem;
  }
  .dash-btn {
    font-weight: 600;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    cursor: pointer;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    min-width: 100px;
    user-select: none;
  }
  .dash-btn--confirm {
    background: #10ac84;
    color: white;
    box-shadow: 0 6px 16px rgba(16, 172, 132, 0.4);
  }
  .dash-btn--confirm:hover {
    background: #0e9e74;
    box-shadow: 0 8px 24px rgba(14, 158, 116, 0.6);
  }
  .dash-btn--cancel {
    background: #ee5253;
    color: white;
    box-shadow: 0 6px 16px rgba(238, 82, 83, 0.4);
  }
  .dash-btn--cancel:hover {
    background: #c23616;
    box-shadow: 0 8px 24px rgba(194, 54, 22, 0.6);
  }

  /* Responsive */
  @media (max-width: 480px) {
    .dash-card-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
  }
</style>

<script>
  const csrftoken = document.querySelector('meta[name="csrf-token"]').getAttribute("content");
  const modal = document.getElementById("logout-modal");
  const logoutLink = document.getElementById("logout-link");
  const cancelLogoutBtn = document.getElementById("cancel-logout");
  const confirmLogoutBtn = document.getElementById("confirm-logout");

  logoutLink.addEventListener("click", (e) => {
    e.preventDefault();
    modal.classList.add("show");
    confirmLogoutBtn.focus();
  });

  cancelLogoutBtn.addEventListener("click", () => {
    modal.classList.remove("show");
  });

  function confirmLogout() {
    fetch("/accounts/logout/", {
      method: "POST",
      headers: {
        "X-CSRFToken": csrftoken,
        "X-Requested-With": "XMLHttpRequest"
      }
    })
    .then(response => {
      if (!response.ok) throw new Error("Network error");
      return response.json();
    })
    .then(data => {
      if (data.redirect_url) {
        window.location.href = data.redirect_url;
      }
    })
    .catch(() => {
      alert("Logout failed. Please try again.");
      modal.classList.remove("show");
    });
  }

  confirmLogoutBtn.addEventListener("click", confirmLogout);

  document.addEventListener("keydown", (e) => {
    if (modal.classList.contains("show")) {
      if (e.key === "Escape") {
        modal.classList.remove("show");
      } else if (e.key === "Enter") {
        confirmLogout();
      }
    }
  });
</script>

{% endblock content %}
